# 仕様について

実装に即した [OpenAPI](./openapi.yml) を別途記述しています。 

## 先生とクラスの制約について
「先生は複数のクラスに所属でき、生徒は単一のクラスに所属ができます。」という記述について、
先生とクラスのカーディナリティの指定がありませんでしたが、
下記のようなユースケースを想定して、一つのクラスに対して複数の先生が所属できる設計にしています。

* 担任 が１人でクラスを持つ
* 担任 + 副担任 の２人でクラスを持つ
* 担任 + 教育実習 複数名でクラスを持つ

## 先生のIDの指定方法
OpenAPI の仕様書の中に先生のIDを指定する箇所がなかったため、クエリパラメータに
`teacherId (required)` を追加しました。

## クエリパタメータについて
OpenAPI 上のパラメータについて、 `type` を実際の値に即したものとしています。
アプリケーションの実装としては `&page=&limit=` のようなリクエストを許容するため `String` で受け取って、その後のバリデーションで弾く形になっています。

### バリデーション
下記のパラメータについてはバリデーションを設けています。
* `page`
  * 最小値を 0 としています。
* `limit`
  * 最小値を 1、最大値を 100 としています。 

### ソートについて
`sort` に値が指定されており、`order` に値が指定されていない場合、デフォルトで降順とするようにしました。
直感的にはデフォルトは昇順ですが、元の OpenAPI で降順の方が優先であるような記述になっていたため、今回は降順をデフォルトとしています。

### 部分一致について
指定できる属性は OpenAPI に記載の２種類だけ（名前: name_like | ログインID: loginId_like）としています。
生徒のID `id_like` やクラス名 `classrooms.name_like` などは部分一致に指定することはできません。

## レスポンスについて

### 200 OK 以外のレスポンス
下記のようにステータスを追加しています。
* クエリパラメータの値が不正な場合（例: &limit=a&order=x）
  * 400 BadRequest
* `teacherId` に対応する先生が存在しない場合
  * 404 NotFound
* 内部エラー
  * 500 InternalServerError

### レスポンススキーマ `students`
`students (required)` に `minItems: 1` と記述がありましたが、
下記のようなケースで検索結果が 0件 になるため、その場合は空の配列を返却するよう、`minItems: 0` に変更しています。

* 先生がクラスを１つも持っていない場合
* 部分一致検索で存在しない検索クエリを入力しが場合

### レスポンススキーマ `students[n].classrooms`
「先生は複数のクラスに所属でき、生徒は単一のクラスに所属ができます。」と記載に対し、
レスポンスの `students[n].classrooms (array)` はその制約に則していない作りになっていますが、
仕様拡張として生徒が複数のクラスに所属するというケースが考えられるため、
後方互換性を考慮して `array` のままとしています。

データベースのスキーマもそのケースを考慮し、`student : classroom` は `1 : n` を許容する設計にしています。
ただし、アプリケーション側では現行の仕様に則し、生徒を検索した際にクラスが 1件 であることを前提として実装しています。

## CORS
今回は [Swagger Editor](https://editor.swagger.io/) などを利用して動作確認ができるよう、 
`Access-Control-Allow-Origin: *` としています。
